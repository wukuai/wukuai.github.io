<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介 | 五块的博客</title><meta name="description" content="INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介"><meta name="author" content="wukuai"><meta name="copyright" content="wukuai"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://avatars2.githubusercontent.com/u/17941566?s=460&v=4"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><meta name="twitter:card" content="summary"><meta name="twitter:title" content="INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介"><meta name="twitter:description" content="INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介"><meta name="twitter:image" content="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg"><meta property="og:type" content="article"><meta property="og:title" content="INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介"><meta property="og:url" content="https://yangwuyuan.com/2018/10/30/INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介/"><meta property="og:site_name" content="五块的博客"><meta property="og:description" content="INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介"><meta property="og:image" content="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://yangwuyuan.com/2018/10/30/INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介/"><link rel="prev" title="REPLACE操作导致主从库AUTO_INCREMENT不一致的分析" href="https://yangwuyuan.com/2019/05/10/REPLACE操作导致主从库AUTO-INCREMENT不一致的分析/"><link rel="next" title="从二分查找到B+树索引原理" href="https://yangwuyuan.com/2017/11/16/从二分查找到B-树索引原理/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://yangwuyuan.com","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script></head><body><canvas class="fireworks"></canvas><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">五块的博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#INSERT-ON-DUPLICATE-KEY-UPDATE语句："><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">INSERT ON DUPLICATE KEY UPDATE语句：</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实例："><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">实例：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#影响行数："><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">影响行数：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#注意："><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">注意：</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#REPLACE-INTO语句："><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">REPLACE INTO语句：</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实例：-1"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">实例：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#影响行数：-1"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">影响行数：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#注意：-1"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">注意：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#BASIC-INSERT语句："><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">BASIC INSERT语句：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#INSERT-IGNORE语句："><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">INSERT IGNORE语句：</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#实验测试："><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">实验测试：</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#INSERT-ON-DUPLICATE-KEY-UPDATE语句："><span class="toc-number">1.</span> <span class="toc-text">INSERT ON DUPLICATE KEY UPDATE语句：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实例："><span class="toc-number">1.1.</span> <span class="toc-text">实例：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#影响行数："><span class="toc-number">1.2.</span> <span class="toc-text">影响行数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意："><span class="toc-number">1.3.</span> <span class="toc-text">注意：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#REPLACE-INTO语句："><span class="toc-number">2.</span> <span class="toc-text">REPLACE INTO语句：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实例：-1"><span class="toc-number">2.1.</span> <span class="toc-text">实例：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#影响行数：-1"><span class="toc-number">2.2.</span> <span class="toc-text">影响行数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意：-1"><span class="toc-number">2.3.</span> <span class="toc-text">注意：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BASIC-INSERT语句："><span class="toc-number">2.4.</span> <span class="toc-text">BASIC INSERT语句：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#INSERT-IGNORE语句："><span class="toc-number">2.5.</span> <span class="toc-text">INSERT IGNORE语句：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实验测试："><span class="toc-number">3.</span> <span class="toc-text">实验测试：</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2018-10-30<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-01-15</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>在参加公司的应届生技术成长项目时，参与了一个在线课堂项目的迭代开发: <a href="http://learn.didichuxing.com，其中一个需求与实现逻辑简述如下：基于已有的观看历史功能，实现人气值功能，若用户是第一次访问该课程则新增一条访问记录且将该课程人气值加1，若以前已经访问过该课程则只更新该课程最后访问时间（人气值可简单理解为点赞数）。" target="_blank" rel="noopener">http://learn.didichuxing.com，其中一个需求与实现逻辑简述如下：基于已有的观看历史功能，实现人气值功能，若用户是第一次访问该课程则新增一条访问记录且将该课程人气值加1，若以前已经访问过该课程则只更新该课程最后访问时间（人气值可简单理解为点赞数）。</a></p>
<p>这是非常常见的业务逻辑：若不存在相关记录则插入，若存在则更新或采取其它操作。在本次项目中原实现观看历史的代码逻辑为先查询表中是否存在欲插入的数据（即是否访问过该课程），若不存在则插入新记录否则更新最后访问时间，即先SELECT然后INSERT或UPDATE。</p>
<p>然而这种做法并不见得效率有多高，还需要考虑事务问题，除了常见的SELECT-&gt;INSERT/UPDATE，本文整理了常用来实现这种或类似逻辑的语句，介绍一下它们的用法与注意点，并进行了简单的性能实验与对比：</p>
<h1 id="INSERT-ON-DUPLICATE-KEY-UPDATE语句："><a href="#INSERT-ON-DUPLICATE-KEY-UPDATE语句：" class="headerlink" title="INSERT ON DUPLICATE KEY UPDATE语句："></a>INSERT ON DUPLICATE KEY UPDATE语句：</h1><p>该语句将先尝试插入指定的记录，若遇到主键（或唯一键）冲突将会尝试更新冲突的记录，若更新又遇到冲突将返回错误。</p>
<h2 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h2><p>建表语句：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`cnt`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uniq_name`</span> (<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>执行以下语句：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'zhangsan'</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'lisi'</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>因表中还没有数据，顺利写入数据，此时以上语句等效于：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'zhangsan'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'lisi'</span>);</span><br></pre></td></tr></table></figure></div></p>
<p><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/BF1594DB2A5E9349A1C80EFB51C321F3.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/BF1594DB2A5E9349A1C80EFB51C321F3.jpg" alt="IMAGE" title="IMAGE"></a></p>
<p>再次执行<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'zhangsan'</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>这时由于存在唯一键name，将产生冲突，name=’zhangsan’的记录将被更新，此时以上语句又等效于：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t <span class="keyword">SET</span> cnt = cnt + <span class="number">1</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'zhangsan'</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></div></p>
<p><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/EC25BA34A254550F32B70540D4C9A5CC.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/EC25BA34A254550F32B70540D4C9A5CC.jpg" alt="IMAGE" title="IMAGE"></a></p>
<p>在使用INSERT ON DUPLICATE KEY UPDATE 语句时可以使用VALUES()函数从INSERT列表中取值，这在多行插入时尤其实用，如：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 (a, b, c) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c = <span class="keyword">VALUES</span>(a) + <span class="keyword">VALUES</span>(b);</span><br></pre></td></tr></table></figure></div></p>
<p>等价于以下两条语句：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 (a, b, c) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 (a, b, c) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c = <span class="number">9</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>若要引用当前记录行的值则直接使用列名即可。</p>
<h2 id="影响行数："><a href="#影响行数：" class="headerlink" title="影响行数："></a>影响行数：</h2><p>影响行数为0：欲插入的记录与当前已有的记录存在冲突，且欲更新的值与当前记录的值相同。<br>影响行数为1：新插入了一条记录。<br>影响行数为2：欲插入的记录与当前已有的记录存在冲突，将当前记录更新为指定值。</p>
<h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><ul>
<li>与多行记录冲突只会更新一条记录：<br>对于上面的数据，如果执行<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'zhangsan'</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<p>欲插入的数据将会和表中的两条数据冲突，那这两条记录都会被更新吗：</p>
<p><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/6ADEC62698178AE703220EB46BF95D0A.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/6ADEC62698178AE703220EB46BF95D0A.jpg" alt="IMAGE" title="IMAGE"></a><br>可以看见返回的影响行数为2，查出来的数据显示只有id=2的一行数据数据被更新了，即若待插入的数据与现有的多条记录冲突，也只会有一条记录被给更新，在使用时应尽量避免这种情况。</p>
<ul>
<li><p>若UPDATE也发生了冲突将会返回错误：<br>若INSERT发生冲突，UPDATE又发生冲突，该语句将返回错误，如果添加IGNORE选项将忽略该错误并记录到WARNING中：<br><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/7973BFD6DEF91F69CE30210552BE6ECF.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/7973BFD6DEF91F69CE30210552BE6ECF.jpg" alt="IMAGE" title="IMAGE"></a></p>
</li>
<li><p>可能造成自增字段的空洞：<br>如表中存在自增字段，如主键id，执行INSERT ON DUPLICATE KEY UPDATE 即使没有新增记录或影响行数为0也将使auto_increment值增加。<br><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/B38E5F9D32232171EE6B4331AB0CD8B0.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/B38E5F9D32232171EE6B4331AB0CD8B0.jpg" alt="IMAGE" title="IMAGE"></a><br><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/8A941B26BBBBF55647AC43B4D45C4191.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/8A941B26BBBBF55647AC43B4D45C4191.jpg" alt="IMAGE" title="IMAGE"></a></p>
</li>
</ul>
<h1 id="REPLACE-INTO语句："><a href="#REPLACE-INTO语句：" class="headerlink" title="REPLACE INTO语句："></a>REPLACE INTO语句：</h1><p>REPLACE处理逻辑：先尝试插入一条新记录，如果因主键冲突或与其他唯一索引冲突则删除原有的有冲突的记录，然后再次尝试插入新纪录。适用于用新纪录覆盖原来记录值的情况，如文章开头提到的课程最后访问时间的逻辑。（注：存储引擎也可能在某些情况下用UPDATE代替DELETE+INSERT，但效果上是一样的）</p>
<h2 id="实例：-1"><a href="#实例：-1" class="headerlink" title="实例："></a>实例：</h2><p>同样是操作上面的表t，执行以下语句：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REPLACE</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="string">'zhangsan'</span>);</span><br></pre></td></tr></table></figure></div></p>
<p><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/DFF40EBAFFA49A6C6B47FE0C1A3E8546.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/DFF40EBAFFA49A6C6B47FE0C1A3E8546.jpg" alt="IMAGE" title="IMAGE"></a></p>
<h2 id="影响行数：-1"><a href="#影响行数：-1" class="headerlink" title="影响行数："></a>影响行数：</h2><p>REPLACE语句返回的影响行数是删除和新增的行数总和。</p>
<p>影响行数为1：新增1行，没有被删除的行。<br>影响行数大于1：在新增记录之前有1行或多行记录被删除，注意如果表中有多个唯一键且待新增的行与原来的多条记录有冲突，REPLACE将会<strong>删除多条记录</strong>再插入新记录。</p>
<p>根据返回的影响行数就可以很容易地判断是仅仅新增记录还是替换了记录。</p>
<h2 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h2><ul>
<li>在REPLACE语句中无法使用当前已有记录行的值:<br>如执行下面的语句多次，其结果均一样，cnt一直是默认值加1，而不是预想的一直累加。<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REPLACE</span> <span class="keyword">INTO</span> t (<span class="keyword">name</span>, cnt) <span class="keyword">VALUES</span> (<span class="string">'zhangsan'</span>, cnt + <span class="number">1</span>);</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<p><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg" alt="IMAGE" title="IMAGE"></a><br><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CB1D05EDC4E54CEC125C5BAAF2EAC5E9.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CB1D05EDC4E54CEC125C5BAAF2EAC5E9.jpg" alt="IMAGE" title="IMAGE"></a></p>
<ul>
<li>可能会删除多条记录<br>若表中有多个唯一键约束，REPLACE将可能会删除多行记录，涉及多个唯一键时若不指定列的值而使用默认值，多次执行也会造成之前的记录被删除。如表中列a, b和c都存在唯一键约束，执行下面的操作将会删除所有有冲突的记录行：<br><a href="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/76DCDA88236D5C5C817EF05B9AB060E5.jpg" data-fancybox="group" data-caption="IMAGE" class="fancybox"><img src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/76DCDA88236D5C5C817EF05B9AB060E5.jpg" alt="IMAGE" title="IMAGE"></a><br>如上图，执行REPLACE into t(a, b, c) values(1, 2, 3)会将原id=1,2,3的记录删除后再插入新记录，故返回的影响行数为4。</li>
<li>表中应当存在唯一键约束：<br>如果REPLACE语句不会触发插入冲突，则在效果上和常规的INSERT语句相同。</li>
<li>在某些情况下（如非主键冲突且一行记录内的冲突只有1个）REPLACE操作在binlog中记录的是(删除加)更新操作，会造成主备库的AUTO_INCREMENT不同。</li>
</ul>
<h2 id="BASIC-INSERT语句："><a href="#BASIC-INSERT语句：" class="headerlink" title="BASIC INSERT语句："></a>BASIC INSERT语句：</h2><p>若遇主键或唯一键冲突，则会执行失败。</p>
<h2 id="INSERT-IGNORE语句："><a href="#INSERT-IGNORE语句：" class="headerlink" title="INSERT IGNORE语句："></a>INSERT IGNORE语句：</h2><p>若欲插入的记录与当前表中的主键或唯一键键冲突，将忽略INSERT语句在执行过程中的错误，新纪录不会被插入表中，可用于避免重复记录的插入。忽略的错误将被记录到WARNING中，通过SHOW WARNINGS语句可查看。</p>
<h1 id="实验测试："><a href="#实验测试：" class="headerlink" title="实验测试："></a>实验测试：</h1><p>本实验均是基于Innodb存储引擎。<br>实验共测试了6种语句：</p>
<ol>
<li>INSERT INTO</li>
<li>INSERT IGNORE INTO</li>
<li>先SELECT再根据结果判断插入或更新</li>
<li>INSERT INTO 若冲突再 UPDATE</li>
<li>REPLACE INTO</li>
<li>INSERT ON DUPLICATE KEY UPDATE</li>
</ol>
<p>建表语句如下，id为主键，a为唯一键<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_xx (</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	a <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">	cnt <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>),</span><br><span class="line">	<span class="keyword">UNIQUE</span> uinq_a (a)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>插入语句如下：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_insert (a) <span class="keyword">VALUES</span> (<span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">IGNORE</span> <span class="keyword">INTO</span> t_insert_ignore (a) <span class="keyword">VALUES</span> (<span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">--先select再update或insert</span></span><br><span class="line"><span class="keyword">SET</span> v = <span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>) + <span class="number">1</span>;</span><br><span class="line">IF EXISTS (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> t_select_then <span class="keyword">WHERE</span> a = v <span class="keyword">LIMIT</span> <span class="number">1</span> )</span><br><span class="line">	<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> t_select_then <span class="keyword">SET</span> a = a + <span class="keyword">scope</span> <span class="keyword">WHERE</span> a = v;</span><br><span class="line">ELSE </span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_select_then (a) <span class="keyword">VALUES</span> (v);</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--先insert若冲突再update</span></span><br><span class="line"><span class="keyword">SET</span> v = <span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>) + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_insert_then (a) <span class="keyword">VALUES</span> (v);</span><br><span class="line">如果插入失败</span><br><span class="line"><span class="keyword">UPDATE</span> t_insert_then <span class="keyword">SET</span> cnt = cnt + <span class="number">1</span> <span class="keyword">WHERE</span> a = v <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">REPLACE</span> <span class="keyword">INTO</span> t_replace (a) <span class="keyword">VALUES</span> (<span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_duplicate (a) <span class="keyword">VALUES</span> (<span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>)) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> cnt = cnt + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--注：scope为传入参数，即随机数范围，控制插入数据时唯一键的冲突率</span></span><br></pre></td></tr></table></figure></div></p>
<p>通过编写存储过程测试不同运行次数下耗时(每次插入或更新就commit)，最后表里的数据量在运行次数的50%-60%，耗时统计如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>运行10W次</th>
<th>运行50W次</th>
<th>运行100W次</th>
<th>运行500W次</th>
</tr>
</thead>
<tbody>
<tr>
<td>INSERT INTO…</td>
<td>48.59s</td>
<td>180.89s</td>
<td>371.69s</td>
<td>30 min 57.46 sec</td>
</tr>
<tr>
<td>INSERT IGNORE INTO…</td>
<td>38.20s</td>
<td>182.13s</td>
<td>299.70s</td>
<td>32 min 34.25 sec</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SELECT 若不存在则 INSERT 否则 UPDATE</td>
<td>59.33s</td>
<td>310.45s</td>
<td>614.21s</td>
<td>56 min 14.27 sec</td>
</tr>
<tr>
<td>INSERT INTO 若冲突再 UPDATE</td>
<td>79.06s</td>
<td>304.80s</td>
<td>743.56s</td>
<td>1 hour 5 min 49.56 sec</td>
</tr>
<tr>
<td>REPLACE INTO…</td>
<td>60.07s</td>
<td>307.05</td>
<td>571.11s</td>
<td>57 min 58.02 sec</td>
</tr>
<tr>
<td>INSERT ON DUPLICATE KEY UPDATE</td>
<td>58.19s</td>
<td>279.76s</td>
<td>572.71s</td>
<td>51 min 44.54 sec</td>
</tr>
</tbody>
</table>
<p>测试随机函数rand()的消耗：<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> p_test_rand (</span><br><span class="line">	<span class="keyword">IN</span> <span class="keyword">count</span> <span class="built_in">int</span> <span class="keyword">UNSIGNED</span>, </span><br><span class="line">	<span class="keyword">IN</span> <span class="keyword">scope</span> <span class="built_in">int</span> <span class="keyword">UNSIGNED</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> s <span class="built_in">int</span> <span class="keyword">UNSIGNED</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> v <span class="built_in">int</span> <span class="keyword">UNSIGNED</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	WHILE s &lt;= count DO</span><br><span class="line">	<span class="keyword">SET</span> v = <span class="keyword">floor</span>(<span class="keyword">rand</span>() * <span class="keyword">scope</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">SET</span> s = s + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure></div></p>
<p>经测试随机函数rand()的耗时占总耗时的1%左右，且不是实验项的变量，可忽略。</p>
<p>后四项实验是实现的是类似的逻辑，可以看出INSERT ON DUPLICATE KEY UPDATE的耗时是占优势的，使用该语句还可以简化程序中的语言逻辑，保证操作的原子性，甚至被称为<a href="https://www.codeforest.net/8-great-mysql-performance-tips" target="_blank" rel="noopener">8个提升mysql性能的技巧之一</a>。当然使用时也需要注意区分使用场景，如果在操作前已经明确知道应当插入还是更新，则直接INSERT/UPDATE效率更高（如第一项实验数据）。</p>
<p>因本人水平有限，对MySQL的理解还不够深入，难免有疏漏或不当之处，欢迎各位拍砖。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">wukuai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yangwuyuan.com/2018/10/30/INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介/">https://yangwuyuan.com/2018/10/30/INSERT ON DUPLICATE KEY UPDATE与 REPLACE 语句简介/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yangwuyuan.com">五块的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_intro/CA59E9D0F51582D6DEE3A47C066B56EB.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/05/10/REPLACE操作导致主从库AUTO-INCREMENT不一致的分析/"><img class="prev_cover lazyload" data-src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/replace_auto_increment/324EB27B73F4CCFB76DCCD49F8D59DD2.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>REPLACE操作导致主从库AUTO_INCREMENT不一致的分析</span></div></a></div><div class="next-post pull_right"><a href="/2017/11/16/从二分查找到B-树索引原理/"><img class="next_cover lazyload" data-src="https://blog-1252157328.cos.ap-beijing.myqcloud.com/b_tree/avl_1.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>从二分查找到B+树索引原理</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'e2h1UB0u5ErGSQbL9Imkbgbg-gzGzoHsz',
  appKey:'1Oqtp6DhWQu3wo6U1Cc9TUvA',
  placeholder:'留下你的脚步吧~',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By wukuai</div><div class="framework-info"><span>Powered by </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme by </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script></body></html>